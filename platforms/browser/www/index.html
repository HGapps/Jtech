<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- CSS -->
  <!--<link rel="stylesheet" href="https://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.css" />-->
  <link rel='stylesheet' id='bootstrap.min-css' href="bs/scss/bootstrap.css" type='text/css' media='all' />
  <link rel='stylesheet' id='bootstrap.min-css-rtl' href='bs/css/bootstrap-rtl.min.css' type='text/css' media='all' />
  <link rel='stylesheet' id='css-style' href='css/style.css' type='text/css' media='all' />
  <link rel='stylesheet' id='css-style' href="css/fa/css/font-awesome.min.css" type='text/css' media='all' />
</head>

<body>
  <div class="preloader"></div>
  <div class="splash">

    <img src="images/logo.png" class="logo" />

    <img src="images/jt-33.png" class="jt jt_device" />


    <a class="skip_to_home btn btn-sm btn-success" style="display:none">متصل بالانترنت ، تابع</a>
    <a class="check_interent btn btn-sm btn-danger" style="display:none">أنت غير متصل بالانترنت !</a>
  </div>
  <div data-role="page" id="main_page">
    <!-- Start page header -->
    <div data-role="header" data-position="fixed" class="header">

      <button id="show_menu" onclick="show_menu()">
          <i class="fa fa-bars"></i>
        </button>


      <button id="logout" style="display:none">
          <i class="fa fa-power-off"></i>
        </button>
      <!--<a data-icon="bars" data-iconpos="notext" data-role="button" href="#menu" class="bars_icon ui-btn-right">القائمة</a>-->
    </div>
    <!-- End page header -->
    <div role="main" class="ui-content main col-xs-12">

      <div id="carouselExampleIndicators" class="carousel slide row" data-ride="carousel">
        <div class="carousel-inner" role="listbox">
          <div class="carousel-item active"><img src="images/A4.jpg" class="" /></div>
          <div class="carousel-item"><img src="images/A4.jpg" class="" /></div>
          <div class="carousel-item"><img src="images/A4.jpg" class="" /></div>
        </div>
        <a class="carousel-control-prev" href="#carouselExampleIndicators" role="button" data-slide="prev">
          <span class="carousel-control-prev-icon" aria-hidden="true"></span>
          <span class="sr-only">Previous</span>
        </a>
        <a class="carousel-control-next" href="#carouselExampleIndicators" role="button" data-slide="next">
          <span class="carousel-control-next-icon" aria-hidden="true"></span>
          <span class="sr-only">Next</span>
        </a>
      </div>

      <div class="alert alert-success login_success" style="display:none">
        تم تسجيل دخولك بنجاح
      </div>
      <div class="login_form page">

        <!--<img src="images/logo.png" class="logo" />-->



        <ul class="nav nav-tabs login_tabs">
          <li class="col-xs-6"><a data-toggle="tab" href="#users" class="active"><i class="fa fa-user"></i> &nbsp; الأفراد</a></li>
          <li class="col-xs-6"><a data-toggle="tab" href="#coms"><i class="fa fa-th"></i> &nbsp; الشركات</a></li>
        </ul>

        <div class="tab-content">
          <div id="users" class="tab-pane fade in active show">


            <input type="text" class="form-control user" name="user" placeholder="اسم المستخدم" value="" pattern="[a-z]{5,10}" required="required" autofocus="autofocus">
            <input type="password" class="form-control pass" name="pass" placeholder="كلمة المرور" value="" required="required">
            <button id="login" class="btn btn-primary col-xs-12">تسجيل الدخول</button>
            <!--<a class="search_link">تخطي ، الاستعلام برقم التذكرة فقط .</a>-->


          </div>
          <div id="coms" class="tab-pane fade">

            <input type="text" class="form-control user border-warning" name="user" placeholder="اسم المستخدم" value="" pattern="[a-z]{5,10}" required="required" autofocus="autofocus">
            <input type="password" class="form-control pass border-warning" name="pass" placeholder="كلمة المرور" value="" required="required">
            <button id="login" class="btn btn-warning col-xs-12">تسجيل الدخول</button>
            <!--<a class="search_link">تخطي ، الاستعلام برقم التذكرة فقط .</a>-->


          </div>

        </div>

      </div>

      <div id="user_index" style="display:none">

        <h2 class="title">المنتجات</h2>

      </div>
      <div class="check_ticket_by_number page" style="display:none"><input type="number" class="form-control t_id" placeholder="اكتب هنا رقم التذكرة" value="" required="required">
        <button class="col-xs-12 btn btn-success t_show">عرض التذكرة</button>
      </div>
      <div role="main" class="col-xs-12 about page" style="display:none">
        <h1>عن تطبيق JANA Tech</h1>
        <p>
          هنالك العديد من الأنواع المتوفرة لنصوص لوريم إيبسوم، ولكن الغالبية تم تعديلها بشكل ما عبر إدخال بعض النوادر أو الكلمات العشوائية إلى النص. إن كنت تريد أن تستخدم نص لوريم إيبسوم ما، عليك أن تتحقق أولاً أن ليس هناك أي كلمات أو عبارات محرجة أو غير لائقة
          مخبأة في هذا النص. بينما تعمل جميع مولّدات نصوص لوريم إيبسوم على الإنترنت على إعادة تكرار مقاطع من نص لوريم إيبسوم نفسه عدة مرات بما تتطلبه الحاجة، يقوم مولّدنا هذا باستخدام كلمات من قاموس يحوي على أكثر من 200 كلمة لا تينية، مضاف إليها مجموعة
          من الجمل النموذجية، لتكوين نص لوريم إيبسوم ذو شكل منطقي قريب إلى النص الحقيقي. وبالتالي يكون النص الناتح خالي من التكرار، أو أي كلمات أو عبارات غير لائقة أو ما شابه. وهذا ما يجعله أول مولّد نص لوريم إيبسوم حقيقي على الإنترنت.


        </p>
      </div>
      <!-- End of POSTS / UI CONTENT -->
      <!-- Start of favs -->
      <div class="favs container-fluid" style="display:none">
        <h2 class="h2">زيارات سابقة History</h2>
        <div class="table-responsive">
          <table class="table table-striped">
            <tbody></tbody>
          </table>
        </div>
      </div>
      <!-- End of favs -->
      <!-- start of loggedin user -->
      <div class="logged_in container-fluid" style="display:none">
        <div class="tickets">
          <div class="table-responsive">
            <table class="authors_table table table-bordered table-striped">
              <thead>
                <tr>
                  <!--<th>رقم التذكرة</th>-->
                  <th>اسم التذكرة</th>
                  <th>حالة التذكرة
                  </th>
                  <!--<th>درجة الأهمية</th> <th>تاريخ الإنشاء </th> <th>قسم</th>-->
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>
      </div>
      <!-- End of loggedin user -->
      <div class="posts"></div>
    </div>
    <!-- End of POSTS / UI CONTENT -->
  </div>
  <!-- End Of main page -->
  <div class="app_body container-fluid">
    <!-- <div class="hr"></div> -->
    <div class="posts container-fluid"></div>
    <!-- End of about -->
  </div>
  <!-- End of app body -->
  <!-- JavaScript -->
  <!--<script src="https://code.jquery.com/jquery-2.1.3.min.js"></script> -->
  <div class="main_menu bottom_buttons">
    <span class="close_me"><i class="fa fa-close"></i></span>
    <a href="index.html" class="active">
        <i class="fa fa-home"></i>
        <span>الرئيسية</span></a>
    <a class="user_index">
            <i class="fa fa-home"></i>
            <span>صفحة المستخدم</span></a>
    <a class="login_link">
        <i class="fa fa-lock"></i>
        <span>تسجيل الدخول</span></a>
    <a class="search_link">
        <i class="fa fa-search"></i>
        <span>الإستعلام برقم التذكرة</span></a>
    <a class="show_favorites">
        <i class="fa fa-star"></i>
        <span>المفضلة</span></a>
    <a class="show_about">
        <i class="fa fa-info"></i>
        <span>عن التطبيق</span></a>
  </div>
  <script src="js/jquery.min.js"></script>

  <script>
    $(document).on('click', '.t_show', function() {
      if ($(".t_id").val() !== "") {
        $(".preloader").fadeIn();
        $t_id = $(".t_id").val();

        //To store the array, do what you're doing: localStorage.setItem("favs", JSON.stringify(favs));
        var favs = JSON.parse(localStorage.getItem("favs") || "[]");
        console.log("# of favs: " + favs.length);
        favs.forEach(function(fav, index) {
          console.log("[" + index + "]: " + fav.id);
        });
        //localStorage.checked_tickets =+ $t_id; alert($t_id);
        var url = "https://hasangad.com/support/api/?Ticket_id=" + $t_id;
        //alert(url);
        $.getJSON(url, function(tick) {
          //alert("test"); console.log(result);
          $("#main_page .posts").html("");
          $("#main_page .posts").append('<div class="col-xs-12"><h2>' + tick['ticket'].title + '</h2><span class="btn btn-warning">' + tick['ticket'].status + '</span></div>');
          $.each(tick['comment'], function(i, comment) {
            //alert('inside comments');
            $("#main_page .posts").append('<div class="col-xs-12 comment"><h2>' + comment.c_date + '</h2><p>' + comment.content + '</p></div>');
          });
          $("#main_page .posts").append('<div class="col-xs-12"><p>' + tick['ticket'].content + '</p></div>');
          $CheckExistsFavs = favs.indexOf($t_id);
          //alert($CheckExistsFavs);
          if ($CheckExistsFavs == -1) {
            favs.push($t_id);
            // Saving
            localStorage.setItem("favs", JSON.stringify(favs));
            //alert(localStorage.getItem("favs"));
          }
          $(".preloader").fadeOut();
        });
      }
    });
    $(document).ready(function() {
      // Check of user logged in before and stored by webstorage
      $storedName = localStorage.getItem('login_is');
      $storedPw = localStorage.getItem('pass_is');
      $storedID = localStorage.getItem('u_id');
      //alert($storedName);
      if ((($storedName !== "") && ($storedPw !== "")) && (($storedName !== null) && ($storedPw !== null))) {
        //alert('You are loged in.');
        $(".login_success").html("مرحباً بعودتك / " + $storedName);
        $(".login_success").fadeIn("1000");
        $(".login_form").hide();
        $(".logged_in").show();
        $("#logout").show();
        // Get Tickets
        var dataString = "get_tickets=true&user=" + $storedID;
        var url_user_tickets = "https://hasangad.com/support/api/?" + dataString;
        $.getJSON(url_user_tickets, function(u_ticks) {
          $.each(u_ticks, function(i, tr) {
            //alert('inside comments'); $(".logged_in table tbody").append('<tr><td><a datalink="" onclick="notify(' + tr.td_id + ')">' + tr.name + '</a></td></tr>');
            $(".logged_in table tbody").append(tr.tr);
          });
          //  $("#main_page .posts").append('<div class="col-xs-12"><h2>' + tick['ticket'].title + '</h2><span class="btn btn-warning">' + tick['ticket'].status + '</span></div>');
        });
      }
      /*else {
                alert('ERROR.');
              }*/
      ////////////// Login Form /
      $("#logout").click(function() {
        localStorage.login_is = "";
        localStorage.pass_is = "";
        localStorage.u_id = "";
        window.location.href = "index.html";
      });
      $("#login").click(function() {
        $("#login").html('جار التحقق ...');
        var user = $(".user").val();
        var pass = $(".pass").val();
        //alert(user); var dataString = "user=" + user + "&pass=" + pass + "&login=";
        var dataString = "user=" + user + "&pass=" + pass;
        var url2 = "https://hasangad.com/support/api/?" + dataString;
        $.getJSON(url2, function(login) {
          //alert("test"); console.log(result);
          $login_status = login.status;
          $u_id = login.u_id;
          if ($login_status == true) {
            // REFRENCE : https://www.w3schools.com/html/html5_webstorage.asp https://www.w3schools.com/jsref/prop_win_localstorage.asp
            localStorage.login_is = user;
            localStorage.pass_is = pass;
            localStorage.u_id = $u_id;
            //alert("Login Success");
            $(".login_form").stop().slideToggle();
            $(".login_success").fadeIn("1000");
            $("#logout").slideDown("1000");
            var url_user_tickets = "https://hasangad.com/support/api/?get_tickets=true&user=" + $u_id;
            $.getJSON(url_user_tickets, function(u_ticks) {
              $.each(u_ticks, function(i, tr) {
                //alert('inside comments');
                $(".logged_in table tbody").append(tr.tr);
                $(".logged_in").fadeIn("1000");
              });
            });
            //$(".login_success").fadeOut("3000");
          } else if ($login_status == false) {
            $("#login").html('تسجيل الدخول');
          }
        });

      });
      ///////////////////////////////////////
      $(".main_menu a i").click(function() {
        $(".main_menu a i").css({
          "color": "#888888"
        });
        $(this).css({
          "color": "#FFBD54"
        });
      });
      $(".skip_to_home").click(function() {
        $(".splash").animate({
          "right": "-100%"
        });
      });

      $(".bottom_buttons a").click(function() {

        $(".bottom_buttons").animate({
          "left": "-100%"
        });
      });

      $(".login_link").click(function() {
        $(".login_form").stop().slideToggle();
        $(".check_ticket_by_number").slideUp();
        $(".logged_in").slideUp();
        $(".about").slideUp();
        $(".favs").slideUp();
        $(".posts").html("");
      });




      $(".user_index").click(function() {
        $("#user_index").stop().slideToggle();
        $(".login_form").slideUp();
        $(".check_ticket_by_number").slideUp();
        $(".logged_in").slideUp();
        $(".about").slideUp();
        $(".favs").slideUp();
        $(".posts").html("");
      });


      $(".search_link").click(function() {
        $(".login_form").slideUp();
        $(".about").slideUp();
        $(".favs").slideUp();
        $(".logged_in").slideUp();
        $(".check_ticket_by_number").stop().slideToggle();
        $(".posts").html("");
      });
      $(".show_about").click(function() {
        $(".about").stop().slideToggle();
        $(".favs").slideUp();
        $(".logged_in").slideUp();
        $(".check_ticket_by_number").slideUp();
        $(".login_form").slideUp();
        $(".posts").html("");
      });
      $(".show_favorites").click(function() {
        $(".favs").stop().slideToggle();
        $(".about").slideUp();
        $(".logged_in").slideUp();
        $(".check_ticket_by_number").slideUp();
        $(".login_form").slideUp();
        $(".posts").html("");
        $get_favs_array = localStorage.getItem("favs");
        if ($get_favs_array !== "" || $get_favs_array !== null) {
          $new_favs = $.parseJSON($get_favs_array);
          if ($new_favs !== null) {
            $.each($new_favs, function(i, fav) {
              //alert(fav);
              var url = "https://hasangad.com/support/api/?Ticket_id=" + fav;
              //alert(url);
              $(".favs table tbody").html("");
              $.getJSON(url, function(tick) {
                //alert("test"); console.log(result); $u_fake_id = $storedID * 2; alert($u_fake_id);  alert(fav); $fav_is = fav;
                $(".favs table tbody").append(
                  '<tr><td><a href="#" data-link="' + fav + '" class="ticket_link" onclick="notify(' + fav + ')">' + tick['ticket'].title + '</a></td><td><span class = "btn btn-warning" > ' + tick['ticket'].status +
                  '</span></td></tr> '
                );
              });
            });
          }
        }
      });
      $(".preloader").fadeOut(500);
    });
    // https://stackoverflow.com/questions/6466135/adding-extra-zeros-in-front-of-a-number-using-jquery
    function pad(str, max) {
      str = str.toString();
      return str.length < max ?
        pad("0" + str, max) :
        str;
    }

    function notify(T_id_is) {
      //console.log(T_id_is); debugger; alert("clicked"); $(".ticket_link").on("click", notify); alert('test'); alert(T_id_is);
      $fav_is = pad(T_id_is, 7);
      //alert($fav_is);
      if ($fav_is !== "") {
        $(".preloader").fadeIn();
        $t_id = $fav_is;
        var url = "https://hasangad.com/support/api/?Ticket_id=" + $t_id;
        $.getJSON(url, function(tick) {
          $("#main_page .posts").html("");
          $("#main_page .posts").append('<div class="col-xs-12"><h2>' + tick['ticket'].title + '</h2><span class="btn btn-warning">' + tick['ticket'].status + '</span></div>');
          $.each(tick['comment'], function(i, comment) {
            $("#main_page .posts").append('<div class="col-xs-12 comment"><h2>' + comment.c_date + '</h2><p>' + comment.content + '</p></div>');
          });
          $("#main_page .posts").append('<div class="col-xs-12 main_ticket"><p>' + tick['ticket'].content + '</p></div>');
          $(".preloader").fadeOut();
        });
      }
    }
    $(document).on('click', '#ticket_link', function() {
      $t_id_from_link_data = $(this).data('link');
      notify($t_id_from_link_data);
    });

    $(".close_me").click(function() {

      $(".bottom_buttons").animate({
        "left": "-100%"
      });
    });

    function show_menu() {
      //$("#show_menu").click(function() {
      $(".bottom_buttons").animate({
        "left": "0"
      });
      //});
    }
  </script>
  <script src="js/bootstrap.min.js"></script>
  <script>
    $(document).ready(function() {


      $('.carousel').carousel({
        interval: 3500
      })



      $('.splash .logo').animate({
        "right": "20%"
      }, 2500);


      $('.jt_device').animate({
        "left": "26%"
      }, 2500);

      setInterval(function() {
        $('.jt_device').animate({
          "opacity": "0.5"
        }, 500);
        $('.jt_device').delay(200).animate({
          "opacity": "1"
        }, 500);
      }, 1000);

    });
  </script>

  <script type="text/javascript" src="cordova.js"></script>
  <script type="text/javascript" src="js/index.js"></script>
  <script type="text/javascript">
    app.initialize();
  </script>

</body>

</html>